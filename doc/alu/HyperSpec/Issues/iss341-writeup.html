<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<!-- Common Lisp HyperSpec (TM), version 3.0 generated by kmp on Thu, 2-May-1996 10:21am EDT -->
<HTML>
<HEAD>
<TITLE>CLHS: Issue SYMBOL-MACROS-AND-PROCLAIMED-SPECIALS Writeup</TITLE>
<META HTTP-EQUIV="Author" CONTENT="Kent M. Pitman">
<META HTTP-EQUIV="Organization" CONTENT="The Harlequin Group Limited">
<LINK REL=TOP HREF="../FrontMatter/index.html">
<LINK REL=COPYRIGHT HREF="../FrontMatter/About-HyperSpec.html#Legal">
<LINK REL=DISCLAIMER HREF="../FrontMatter/About-HyperSpec.html#Disclaimer">
<LINK REL=PREV HREF="../Issues/iss340-writeup.html">
<LINK REL=UP HREF="../Issues/iss341.html">
<LINK REL=NEXT HREF="../Issues/iss342-writeup.html">
</HEAD>
<BODY BGCOLOR="#c0c0c0">
<H1><A REV=MADE HREF="http://www.harlequin.com/"><IMG ALT="[HARLEQUIN]" SRC="../Graphics/Harlequin-Small.gif" ALIGN=Bottom></A><A REL=TOP HREF="../FrontMatter/index.html"><IMG ALT="[Common Lisp HyperSpec (TM)]" SRC="../Graphics/HyperSpec-Small.gif" ALIGN=Bottom></A> <A REL=PREV HREF="../Issues/iss340-writeup.html"><IMG ALT="[Previous]" SRC="../Graphics/Prev.gif" ALIGN=Bottom></A><A REL=UP HREF="../Issues/iss341.html"><IMG ALT="[Up]" SRC="../Graphics/Up.gif" ALIGN=Bottom></A><A REL=NEXT HREF="../Issues/iss342-writeup.html"><IMG ALT="[Next]" SRC="../Graphics/Next.gif" ALIGN=Bottom></A></H1>

<HR>



<H2>Issue SYMBOL-MACROS-AND-PROCLAIMED-SPECIALS Writeup</H2>

<PRE><B>Issue:</B>            <A HREF="iss341.html">SYMBOL-MACROS-AND-PROCLAIMED-SPECIALS</A><P>
<B>References:</B>       <A REL=DEFINITION HREF="../Body/speope_symbol-macrolet.html#symbol-macrolet"><B>SYMBOL-MACROLET</B></A>, <A REL=DEFINITION HREF="../Body/dec_special.html#special"><B>SPECIAL</B></A> proclamation,<P>
                  AUGMENT-ENVIRONMENT,<P>
                  <A REL=DEFINITION HREF="../Body/fun_constantp.html#constantp"><B>CONSTANTP</B></A>, VARIABLE-INFORMATION<P>
Related issues:   Issue <A HREF="iss338.html">SYMBOL-MACROLET-DECLARE</A><P>
                  Issue <A HREF="iss339.html">SYMBOL-MACROLET-SEMANTICS</A><P>
                  Issue <A HREF="iss343.html">SYNTACTIC-ENVIRONMENT-ACCESS</A><P>
                  Issue <A HREF="iss085.html">CONSTANTP-ENVIRONMENT</A><P>
                  Issue <A HREF="iss084.html">CONSTANTP-DEFINITION</A><P>
<B>Category:</B>         CLARIFICATION<P>
<B>Edit history:</B>     v1, 15 Feb 1991, Sandra Loosemore<P>
                  v2, 13 Mar 1991, Sandra Loosemore<P>
<P>
<B>Problem description:<P>
</B><P>
  Can a symbol-macro definition shadow a variable that has been<P>
  PROCLAIMed <A REL=DEFINITION HREF="../Body/dec_special.html#special"><B>SPECIAL</B></A> or defined as a constant using DEFCONSTANT?<P>
<P>
  Both <A REL=DEFINITION HREF="../Body/dec_special.html#special"><B>SPECIAL</B></A> proclamations and <A REL=DEFINITION HREF="../Body/mac_defconstant.html#defconstant"><B>DEFCONSTANT</B></A> definitions pervasively<P>
  affect the semantics of variable bindings.  The question is whether a<P>
  symbol-macro binding of a symbol in the variable namespace is a <P>
  variable binding in this sense.<P>
<P>
  Note that issues <A HREF="iss338.html">SYMBOL-MACROLET-DECLARE</A> and <A HREF="iss343.html">SYNTACTIC-ENVIRONMENT-ACCESS</A><P>
  <A REL=DEFINITION HREF="../Body/fun_providecm_require.html#require"><B>require</B></A> that an error be signalled if a <A REL=DEFINITION HREF="../Body/dec_special.html#special"><B>SPECIAL</B></A> declaration is supplied <P>
  for a name being bound as a symbol-macro.<P>
<P>
  There are two proposals, SHADOWING-PERMITTED and SIGNALS-AN-ERROR.<P>
<P>
<B>Proposal (SYMBOL-MACROS-AND-PROCLAIMED-SPECIALS:SHADOWING-PERMITTED):<P>
</B><P>
  Clarify that a SYMBOL-MACRO definition of a symbol shadows any other<P>
  interpretation of that symbol as a variable, even if the symbol is<P>
  a keyword or has been PROCLAIMed <A REL=DEFINITION HREF="../Body/dec_special.html#special"><B>SPECIAL</B></A> or defined as a constant <P>
  using <A REL=DEFINITION HREF="../Body/mac_defconstant.html#defconstant"><B>DEFCONSTANT</B></A>.<P>
<P>
  Note that lexical shadowing of keywords and defined constants <P>
  requires the use of an environment argument with <A REL=DEFINITION HREF="../Body/fun_constantp.html#constantp"><B>CONSTANTP</B></A> (see issue <P>
  <A HREF="iss085.html">CONSTANTP-ENVIRONMENT</A>).  Clarify that if the first argument to<P>
  <A REL=DEFINITION HREF="../Body/fun_constantp.html#constantp"><B>CONSTANTP</B></A> is a symbol that is a keyword or globally defined as a <P>
  constant, <A REL=DEFINITION HREF="../Body/fun_constantp.html#constantp"><B>CONSTANTP</B></A> must return true only if that symbol is not <P>
  lexically shadowed by a symbol-macro definition in the specified <P>
  environment.  Likewise, VARIABLE-INFORMATION returns :SYMBOL-MACRO <P>
  rather than :CONSTANT as its first value if the symbol is a keyword <P>
  or defined constant that has been lexically shadowed by a symbol-macro <P>
  definition in the specified environment.<P>
<P>
  Rationale:<P>
<P>
    This is a reasonable interpretation to some people.<P>
<P>
<P>
<B>Proposal (SYMBOL-MACROS-AND-PROCLAIMED-SPECIALS:SIGNALS-AN-ERROR):<P>
</B><P>
  Clarify that a SYMBOL-MACRO definition of a symbol that is a keyword<P>
  or that has been PROCLAIMed <A REL=DEFINITION HREF="../Body/dec_special.html#special"><B>SPECIAL</B></A> or defined as a constant using<P>
  <A REL=DEFINITION HREF="../Body/mac_defconstant.html#defconstant"><B>DEFCONSTANT</B></A> is not permitted.<P>
<P>
  Require <A REL=DEFINITION HREF="../Body/speope_symbol-macrolet.html#symbol-macrolet"><B>SYMBOL-MACROLET</B></A> to signal an error if any of the symbols being <P>
  bound as a symbol-macro are keywords, PROCLAIMed <A REL=DEFINITION HREF="../Body/dec_special.html#special"><B>SPECIAL</B></A> or defined as<P>
  a constant using <A REL=DEFINITION HREF="../Body/mac_defconstant.html#defconstant"><B>DEFCONSTANT</B></A>.<P>
<P>
  Require AUGMENT-ENVIRONMENT to signal an error if any of the symbols in <P>
  the :SYMBOL-MACRO alist are keywords, PROCLAIMed <A REL=DEFINITION HREF="../Body/dec_special.html#special"><B>SPECIAL</B></A> or defined as a<P>
  constant using <A REL=DEFINITION HREF="../Body/mac_defconstant.html#defconstant"><B>DEFCONSTANT</B></A>.<P>
<P>
  Rationale:<P>
<P>
    This is a reasonable interpretation to some people.<P>
<P>
    There is also a compatibility problem if <A REL=DEFINITION HREF="../Body/fun_constantp.html#constantp"><B>CONSTANTP</B></A> is permitted to<P>
    be sensitive to the lexical environment in which the form appears <P>
    (see the cost to users section below).<P>
<P>
<P>
<B>Examples:<P>
</B><P>
  #1:  (<A REL=DEFINITION HREF="../Body/mac_defparametercm_defvar.html#defvar"><B>defvar</B></A> *foo* nil)<P>
       (<A REL=DEFINITION HREF="../Body/speope_symbol-macrolet.html#symbol-macrolet"><B>symbol-macrolet</B></A> ((*foo*  t))<P>
           *foo*)<P>
<P>
       Under proposal SHADOWING-PERMITTED, this returns T.<P>
       Under proposal SIGNALS-AN-ERROR, an error is signalled.<P>
<P>
<P>
  #2:  (<A REL=DEFINITION HREF="../Body/mac_defconstant.html#defconstant"><B>defconstant</B></A> frob &quot;frob-constant&quot;)<P>
       (<A REL=DEFINITION HREF="../Body/mac_defmacro.html#defmacro"><B>defmacro</B></A> see-if-constant (form)<P>
           `(<A REL=DEFINITION HREF="../Body/speope_progn.html#progn"><B>progn</B></A> ,form ,(<A REL=DEFINITION HREF="../Body/fun_constantp.html#constantp"><B>constantp</B></A> form)))<P>
       (<A REL=DEFINITION HREF="../Body/speope_symbol-macrolet.html#symbol-macrolet"><B>symbol-macrolet</B></A> ((frob (<A REL=DEFINITION HREF="../Body/fun_funcall.html#funcall"><B>funcall</B></A> #'some-hairy-function)))<P>
           (see-if-constant frob))<P>
<P>
       Under proposal SHADOWING-PERMITTED, this returns T; note that<P>
           the call to <A REL=DEFINITION HREF="../Body/fun_constantp.html#constantp"><B>CONSTANTP</B></A> returns a value appropriate for the<P>
           null lexical environment but does not take into account the<P>
           local symbol-macro definition of FROB.<P>
<P>
       Under proposal SIGNALS-AN-ERROR, an error is signalled.<P>
<P>
<P>
<B>Current Practice:<P>
</B><P>
  Apparently shadowing is permitted in some implementations but not<P>
  others.<P>
<P>
<B>Cost to Implementors:<P>
</B><P>
  Proposal SHADOWING-PERMITTED is more work than SIGNALS-AN-ERROR<P>
  since all calls to <A REL=DEFINITION HREF="../Body/fun_constantp.html#constantp"><B>CONSTANTP</B></A> within the implementation need to be <P>
  examined to see whether an environment argument must be passed.  This<P>
  also requires that something other than <A REL=DEFINITION HREF="../Body/fun_eval.html#eval"><B>EVAL</B></A> (like <A REL=DEFINITION HREF="../Body/fun_funcall.html#funcall"><B>FUNCALL</B></A> of ENCLOSE)<P>
  be used to compute the value of something that is <A REL=DEFINITION HREF="../Body/fun_constantp.html#constantp"><B>CONSTANTP</B></A>.<P>
<P>
<B>Cost to Users:<P>
</B><P>
  Many applications that now use <A REL=DEFINITION HREF="../Body/fun_constantp.html#constantp"><B>CONSTANTP</B></A> assume that the value it returns<P>
  is not sensitive to the lexical environment in which the form appears.<P>
  (Since <A REL=DEFINITION HREF="../Body/fun_constantp.html#constantp"><B>CONSTANTP</B></A> has <A REL=DEFINITION HREF="../Body/any_not.html#not"><B>not</B></A> previously been specified to accept an <P>
  environment argument, it is hard to see how any other interpretation<P>
  could be made.)  Proposal SHADOWING-PERMITTED represents an incompatible <P>
  change in this respect.  All calls to <A REL=DEFINITION HREF="../Body/fun_constantp.html#constantp"><B>CONSTANTP</B></A> within user programs <P>
  would have to be examined to see whether an environment argument must <P>
  be passed.  This also requires that something other than <A REL=DEFINITION HREF="../Body/fun_eval.html#eval"><B>EVAL</B></A> (like <P>
  <A REL=DEFINITION HREF="../Body/fun_funcall.html#funcall"><B>FUNCALL</B></A> of ENCLOSE) be used to compute the value of something that is <P>
  <A REL=DEFINITION HREF="../Body/fun_constantp.html#constantp"><B>CONSTANTP</B></A>.<P>
<P>
<B>Cost of non-adoption:<P>
</B><P>
  The language specification is unnecessarily vague.<P>
<P>
<B>Performance impact:<P>
</B><P>
  Probably none.<P>
<P>
<B>Benefits:<P>
</B><P>
  The cost of non-adoption is avoided.<P>
<P>
<B>Esthetics:<P>
</B><P>
  Seems to depend on who you talk to.<P>
<P>
  Most people seem to acknowledge that shadowing proclaimed specials and<P>
  defined constants with symbol-macros is abominable programming style.<P>
<P>
  Some people think disallowing shadowing complicates the language<P>
  unnecessarily by introducing yet another special case.<P>
<P>
  Some people think permitting shadowing complicates the language<P>
  unnecessarily by destroying the &quot;globalness&quot; of special proclamations <P>
  and constant definitions.<P>
  <P>
<P>
<B>Discussion:<P>
</B><P>
  This issue was discussed on the x3j13 mailing list in May/June 1990.<P>
</PRE>

<HR>

<A REL=NAVIGATOR HREF="../FrontMatter/Starting-Points.html"><IMG ALT="[Starting Points]" SRC="../Graphics/Starting-Points.gif" ALIGN=Bottom></A><A REL=TOC HREF="../FrontMatter/Chapter-Index.html"><IMG ALT="[Contents]" SRC="../Graphics/Contents.gif" ALIGN=Bottom></A><A REL=INDEX HREF="../FrontMatter/Master-Index.html"><IMG ALT="[Index]" SRC="../Graphics/Index.gif" ALIGN=Bottom></A><A REL=INDEX HREF="../FrontMatter/Symbol-Index.html"><IMG ALT="[Symbols]" SRC="../Graphics/Symbols.gif" ALIGN=Bottom></A><A REL=GLOSSARY HREF="../Body/sec_26-1.html"><IMG ALT="[Glossary]" SRC="../Graphics/Glossary.gif" ALIGN=Bottom></A><A HREF="../Issues/Issues-Categorized.html"><IMG ALT="[Issues]" SRC="../Graphics/Issues.gif" ALIGN=Bottom></A><BR>

<A REL=COPYRIGHT HREF="../FrontMatter/About-HyperSpec.html#Legal"><I>Copyright 1996, The Harlequin Group Limited.  All Rights Reserved.</I></A><P>
</BODY>
</HTML>
